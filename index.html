<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ランダムサウンド再生システム (Auto MP3)</title>
    <link rel="stylesheet" href="system/style.css">
</head>
<body>

    <h1>🔊 Random Sound Player</h1>

    <div class="container">
        
        <div class="card">
            <h2>再生コントロール</h2>
            
            <div class="control-group">
                <label for="mainGroupSelect">再生グループ</label>
                <select id="mainGroupSelect"></select>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="reduceRepeat" checked>
                    前回と同じ音の確率を下げる (50%)
                </label>
            </div>

            <div class="control-group">
                <div class="row">
                    <div class="col">
                        <label>音量: <span id="volDisplay">50%</span></label>
                        <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div class="col">
                        <label>間隔: <span id="intervalDisplay">1.5秒</span></label>
                        <input type="range" id="intervalRange" min="0.2" max="5.0" step="0.1" value="1.5">
                    </div>
                </div>
            </div>

            <div class="control-group">
                <details>
                    <summary>確率詳細設定を開く</summary>
                    <div class="details-content">
                        <label>確率増加モード</label>
                        <div class="radio-group">
                            <label><input type="radio" name="probMode" value="linear" checked> ➕ 等速</label>
                            <label><input type="radio" name="probMode" value="exponential"> 🚀 指数</label>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label>初期確率(%)</label>
                                <input type="number" id="initProb" value="10" min="0.1" max="100" step="0.1">
                            </div>
                            <div class="col" id="linearSetting">
                                <label>増加量(+%)</label>
                                <input type="number" id="stepProb" value="10" min="0" max="100">
                            </div>
                            <div class="col hidden" id="exponentialSetting">
                                <label>倍率(×)</label>
                                <input type="number" id="multiProb" value="1.5" step="0.1">
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <div class="player-buttons">
                <button id="startBtn" class="btn btn-play">開始</button>
                <button id="stopBtn" class="btn btn-stop" disabled>停止</button>
            </div>

            <div class="status-box" id="statusDisplay">設定を読み込みました</div>
        </div>

        <div class="card">
            <h2>🛠️ システム設定・ファイル管理</h2>
            
            <details open>
                <summary>📂 音声ファイル登録 (soundフォルダ内のファイル名)</summary>
                <div class="settings-area">
                    <div class="list-container" id="fileListContainer">
                        </div>
                    <div class="row input-row">
                        <input type="text" id="newFileName" placeholder="例: bell (.mp3は不要)">
                        <input type="file" id="filePicker" accept=".mp3" hidden>
                        <button class="btn btn-sm btn-secondary" id="browseBtn" title="ファイルを選択して名前を入力">📂 参照</button>
                        <button class="btn btn-sm btn-primary" id="addFileBtn">追加</button>
                    </div>
                    <div class="note-text">※ 「参照」または入力後「追加」を押してください。ファイル自体は手動で sound フォルダに入れてください。</div>
                    <div class="note-text">※ 入力後、自動的に .mp3 が付与されます。</div>
                </div>
            </details>

            <details class="mt-10">
                <summary>🗂️ グループ設定</summary>
                <div class="settings-area">
                    <div class="control-group">
                        <label>編集するグループを選択 (または新規作成)</label>
                        <div class="row">
                            <select id="editGroupSelect"></select>
                            <button id="deleteGroupBtn" class="btn btn-sm btn-danger">削除</button>
                        </div>
                        <div class="row mt-5">
                            <input type="text" id="newGroupName" placeholder="新規グループ名">
                            <button id="createGroupBtn" class="btn btn-sm btn-primary">作成</button>
                        </div>
                    </div>

                    <div id="groupEditorArea" class="hidden">
                        <label>このグループに含めるファイル:</label>
                        <div class="file-select-area" id="groupFileCheckboxes">
                            </div>
                        <button id="saveGroupConfigBtn" class="btn btn-save">グループ内容を保存</button>
                    </div>
                </div>
            </details>

            <details class="mt-10">
                <summary>💾 設定ファイルの保存・読込</summary>
                <div class="settings-area">
                    <p class="desc-text">現在の設定をファイルに保存、または読み込みます。</p>
                    <div class="row">
                        <button id="exportBtn" class="btn btn-sm btn-info flex-1">設定をファイルに保存(DL)</button>
                        <label class="btn btn-sm btn-secondary flex-1 text-center cursor-pointer">
                            設定ファイルを読込
                            <input type="file" id="importFile" accept=".json" hidden>
                        </label>
                    </div>
                </div>
            </details>
        </div>

    </div>

    <script src="system/app.js"></script>
</body>
</html>